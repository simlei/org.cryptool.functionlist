# Workflows

The "**Main program step**" in each workflow marks the step which is to be performed successfully (and should be included in the step sequence with its dependencies in the `config.yaml`/command line arguments) for that workflow.

For an overview of how the steps work together by default, see [Steps Config and Data](config_data.md)

In the general case, simply running all steps from the `config.yaml` would be the simplest approach. For specialized tasks, omit unnecessary steps; for this, consult [Steps Config and Data][config_data.md].

## Change files and test changes

This describes how to see what the result of manually changed files look like. In general, this comes down to looking into the files that were generated as step results in `./ws`. However, there is a step that generates an interactive html page of the function list:

**Main program step**: `step.tohtml_{de,en}`; it generates a dynamic html page that emulates the eventual online result on cryptool.org.

- run `./src/flistapp.py` with the preconfigured configuration, or step names as arguments, including `step.tohtml_{de,en}`.
- after the run completes without errors, check the HTML page `${step.tohtml_{de,en}.output}` for an interactive version of the final result. By default, this points to `./sphinx-doc/genFlistHtml/html_{de,en}/index.html`.
- change input files of the steps where necessary, repeat if necessary.

Note, that the on-line version at [https://simlei.github.io/org.cryptool.functionlist/sphinx-doc/genFlistHtml/index.html](https://simlei.github.io/org.cryptool.functionlist/sphinx-doc/genFlistHtml/index.html) can be tried out without running the program at all, but reflects only the output of the contributor that last pushed it to github.

## Add category mappings for CT2 and JCT

**Main program step**: `step.categories_{ct2,jct}_{de,en}`

Categories are not generated by JCT and CT2 as these tools have no notion of this data. It is manually assigned to IDs of functionality in the steps `step.categories_{jct,ct2}_{en,de}`.

- The categories available are listed in `step.categories_{jct,ct2}_{en,de}.catfile`: `${workspace}/data/categories_jct.csv`. Only categories that are in this file can be assigned to csv rows.
- After running the program where it was detected that some categories are missing, the user is notified of it on the console output and asked to edit the file configured as `step.categories_{ct2,jct}_{en,de}.feedbackfile`.
- These feedback files have placeholders where the user should enter the categories (always use the english version).
- re-run the program as before -- the categories from the feedback files are now integrated. This can be observed from counters in the console output.

To consider:

- ca. 500 category mappings have been extracted from legacy data. The extracted mappings are the "trunk" input of the category database and resides in `step.categories_{ct2,jct}.input`.
- After the feedback file manual input has been verified to be correct, it should be cut and pasted at some time to the end of this "trunk" input filein `./ws` and more importantly, `./ws-static`, where it can be versioned by git and used as workspace template for other collaborators.

## Add functionality mappings for JCT

**Main program step**: `step.CT2scsv_{jct}_{de,en}`

The data necessary to group multiple functionalities under a common name is not provided by the JCT implementation. Thus, JCT entries are generated as each functionality being in its own group under its own name.


For now, this can be worked around by editing the input files for `step.CT2scsv_jct_{de,en}` by hand. This can then later be used to extract the manual work done via script and create the ID-to-functionality mapping as is practiced already with categories.

The structure of these files is as follows, on the english example:

(by default, `step.CT2scsv_jct_{de,en}.input` = `./ws/data/en/scsv_generated/jct.csv`)

```
[...]
Camellia192_CBC;[n.a.];
;[A];Block Ciphers \ Camellia \ Camellia192_CBC

Camellia128_CBC;[n.a.];
;[A];Block Ciphers \ Camellia \ Camellia128_CBC
[...]
```

English and German versions have to by symmetrical -- each line has to have the exact translated correspondence in the other file.

Following an empty line is the "Functionality group", followed by a semicolon, followed by a string that has to be there for legacy reasons, followed by a final semicolon. 
Then, without newlines, follow functionality addresses within the tool. Such a line has to start with a semicolon. Then, a single character in brackets indicates one of possibly many ways a tool offers functionalities. After another semicolon, backslash- or slash-separated path elements indicate a path the user has to follow (e.g. with mouse clicks in a menu) to reach the functionality.
The above example could be grouped like this:

```
[...]
Camellia;[n.a.];
;[A];Block Ciphers \ Camellia \ Camellia192_CBC
;[A];Block Ciphers \ Camellia \ Camellia128_CBC
[...]
```

... and accordingly, in the german file.

It would be sensible to make a small change in both languages, side by side, and check if `./src/flistapp.py` runs without error. If there are errors, the line number and reason for failure will be printed. When confident, proceed to edit the whole file and re-run only from time to time.

There is no way yet to teach JCT this clustering of functionalities -- but there may be in the future, based on these manual edited files.

TODO: to be handled soon in the same way as the categories.

## Make changes permanent

The workspace folder is somewhat of a temporary state; it is target of temporary and user-feedback files. It's created initially as a clean copy of the `./ws-static` directory. It is also not tracked by version control, except for the `www` subdirectory (for convenience and simple web hosting).

This means, that git-revisionable, permanent user input (like category and functionality group inputs) should be made permanent by copying them over to `./ws-static` when the user is confident that the copied data is suitable.

## Update the website

**Main program step**: `step.tofinalform_{de,en}`

- The files configured as `step.tofinalform_{de,en}.output` are of a format that is suitable to be imported into the database of [cryptool.org](https://cryptool.org). Log into the [PHPMyAdmin](https://www.cryptool.org/restricted/phpmyadmin/) interface (credentials required, Webmaster: js {at} joerg {space} schneider {dot} com).
- Locate the databases "`j373_custom_cryptool_functions{de,en}`".
- In the upper navigation bar, select "Import"
- Choose CSV as import format, with semicolon delimiter (`;`)
- After a short while, the updated website should be available. Try Ctrl+F5 if it does not update.
